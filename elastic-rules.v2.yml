groups:
- name: Rules from github.com/jsuchenia/elasticsearch-prometheus-metrics
  rules:
  - alert: EsCpuCritical
    expr: es_cpu_percentage > 95
    for: 3m
    labels:
      severity: critical
    annotations:
      description: '{{$labels.instance}} reports critical cpu usage'
      summary: Critical CPU usage on {{$labels.instance}}
  - alert: EsMemoryCritical
    expr: es_memory_free_percentage < 10
    for: 3m
    labels:
      severity: critical
    annotations:
      description: '{{$labels.instance}} reports critical free memory state'
      summary: Critical Free memory usage on {{$labels.instance}}
  - alert: EsStatusCritical
    expr: es_status > 1
    for: 1m
    labels:
      severity: critical
    annotations:
      description: '{{$labels.instance}} reports critical status of ElasticSearch
        cluster'
      summary: Critical cluster on {{$labels.instance}}
  - alert: EsStatusWarning
    expr: es_status == 1
    for: 3m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports non-healthy status of ElasticSearch
        cluster'
      summary: NonHealthy cluster on {{$labels.instance}}
  - alert: EsUnassigedShards
    expr: es_unassigned_shards > 0
    for: 3m
    labels:
      severity: warning
    annotations:
      description: There are unassigned shards for more than 3 minutes on {{$labels.cluster}}
      summary: Unassigned shards on {{$labels.cluster}}
  - alert: EsActiveShardsPercentage
    expr: es_shards_active_percentage < 100
    for: 3m
    labels:
      severity: warning
    annotations:
      description: Not all shards are active on {{$labels.cluster}} for more than
        3 minutes
      summary: Non-active shards on {{$labels.cluster}}
  - alert: TooManyIndexFailures
    expr: rate(es_docindexfailed_count[1m]) > 0.1
    labels:
      severity: warning
    annotations:
      description: Too many failures while indexing documents on node {{$labels.instance}}
      summary: Indexing failures
  - alert: IndexIsThrootled
    expr: es_docindex_isthrotled > 0
    for: 3m
    labels:
      severity: warning
    annotations:
      description: Index is throtled for more than 3minutes {{$labels.index}}
      summary: Index {{$labels.index}} throttled for more than 3 minutes
  - alert: IndexUnassignedShards
    expr: es_index_unassigned_shards > 0
    for: 3m
    labels:
      severity: warning
    annotations:
      description: Unassigned shards on index {{$labels.index}} from {{$labels.cluster}}
        for more than 3 minutes
      summary: Unassigned shards on {{$labels.index}} at {{$labels.cluster}}
  - alert: JvmMemory
    expr: jvm_memory_bytes_used / jvm_memory_bytes_max > 0.95
    for: 1m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports high memory consumption for more
        than 1 minute'
      summary: High JVM memory consumption on node {{$labels.instance}}
  - alert: JvmMemoryPercent
    expr: ec_jvm_memory_heap_used_percen > 95
    for: 1m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports high memory consumtion for more than
        1 minute'
      summary: High JVM memory consumption on node {{$labels.instance}}
  - alert: ClusterAllocationDisabled
    expr: cluster_settings{cluster_routing_allocation_enable="none"} > 0
    for: 5m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports that cluster allocation has been
        disabled for {{$labels.cluster}}'
      summary: Cluster allocation disabled on cluster {{$labels.cluster}}
  - alert: ClusterRebalanceDisabled
    expr: cluster_settings{cluster_routing_rebalance_enable="none"} > 0
    for: 5m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports that cluster rebalance has been disabled
        on {{$labels.cluster}}'
      summary: Cluster rebalance disabled on cluster {{$labels.cluster}}
  - alert: ClusterAllocationDisabledPersistently
    expr: cluster_persistent_settings{cluster_routing_allocation_enable="none"} >
      0
    for: 5m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports that cluster allocation has been
        disabled for {{$labels.cluster}}'
      summary: Cluster allocation disabled on cluster {{$labels.cluster}}
  - alert: ClusterRebalanceDisabledPersistently
    expr: cluster_persistent_settings{cluster_routing_rebalance_enable="none"} > 0
    for: 5m
    labels:
      severity: warning
    annotations:
      description: '{{$labels.instance}} reports that cluster rebalance has been disabled
        on {{$labels.cluster}}'
      summary: Cluster rebalance disabled on cluster {{$labels.cluster}}
  - alert: ClusterReadOnly
    expr: cluster_settings{cluster_blocks_read_only!="false"} > 0
    for: 1m
    labels:
      severity: critical
    annotations:
      description: '{{$labels.instance}} reports that cluster {{$labels.cluster}}
        is in read-only mode'
      summary: Cluster {{$labels.cluster}} is read-only
  - alert: ClusterReadOnlyPersistently
    expr: cluster_persistent_settings{cluster_blocks_read_only!="false"} > 0
    for: 1m
    labels:
      severity: critical
    annotations:
      description: '{{$labels.instance}} reports that cluster {{$labels.cluster}}
        is in read-only mode'
      summary: Cluster {{$labels.cluster}} is read-only
